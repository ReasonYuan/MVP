//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/liaomin/Documents/workspace/Android/DocPlusLogic/src/com/fq/lib/UserActionManger.java
//
//  Created by liaomin on 15-5-4.
//

#line 1 "/Users/liaomin/Documents/workspace/Android/DocPlusLogic/src/com/fq/lib/UserActionManger.java"

#include "Constants.h"
#include "DES3Utils.h"
#include "FileHelper.h"
#include "FileSystem.h"
#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "JSONArray.h"
#include "JSONException.h"
#include "JSONObject.h"
#include "UserAction.h"
#include "UserActionManger.h"
#include "java/lang/System.h"
#include "java/util/ArrayList.h"
#include "java/util/Collections.h"


#line 14
@implementation ComFqLibUserActionManger

ComFqLibUserActionManger * ComFqLibUserActionManger_mInstance_;

- (id)init {
  return [super init];
}

+ (ComFqLibUserActionManger *)getInstance {
  
#line 23
  if (ComFqLibUserActionManger_mInstance_ == nil) {
    ComFqLibUserActionManger_mInstance_ = [[ComFqLibUserActionManger alloc] init];
    
#line 26
    ComFqLibUserActionManger_mInstance_->mActions_ = [[JavaUtilArrayList alloc] init];
    [ComFqLibUserActionManger_mInstance_->mActions_ clear];
    FQJSONArray *array = nil;
    @try {
      
#line 31
      NSString *str = [ComFqLibFileHelper readStringWithNSString:[((ComFqHalcyonExtendFilesystemFileSystem *) nil_chk([ComFqHalcyonExtendFilesystemFileSystem getInstance])) getUserActionPath] withBoolean:NO];
      if (str != nil && ![@"" isEqual:str]) {
        NSString *miwen = [NSString stringWithString:[ComFqLibPlatformDES3Utils decryptModeWithByteArray:[str getBytes] withByteArray:ComFqLibToolsConstants_get_KEY_STRING_()]];
        array = [[FQJSONArray alloc] initWithNSString:miwen];
      }
    }
    @catch (
#line 36
    FQJSONException *e1) {
      [((FQJSONException *) nil_chk(e1)) printStackTrace];
      array = [[FQJSONArray alloc] init];
    }
    if (array != nil) {
      for (int i = 0; i < [array length]; i++) {
        @try {
          FQJSONObject *obj = [array getJSONObjectWithInt:i];
          ComFqHalcyonEntityUserAction *action = [[ComFqHalcyonEntityUserAction alloc] init];
          [action setAtttributeByjsonWithFQJSONObject:obj];
          [ComFqLibUserActionManger_mInstance_->mActions_ addWithId:action];
        }
        @catch (
#line 47
        FQJSONException *e) {
          [((FQJSONException *) nil_chk(e)) printStackTrace];
        }
      }
    }
  }
  return ComFqLibUserActionManger_mInstance_;
}


#line 57
- (void)addActionWithComFqHalcyonEntityUserAction:(ComFqHalcyonEntityUserAction *)action {
  
#line 58
  [((JavaUtilArrayList *) nil_chk(mActions_)) addWithInt:0 withId:action];
  if ([mActions_ size] > 10) {
    (void) [mActions_ removeWithInt:10];
  }
  
#line 63
  FQJSONArray *array = [[FQJSONArray alloc] init];
  for (ComFqHalcyonEntityUserAction * __strong act in mActions_) {
    FQJSONObject *obj = [((ComFqHalcyonEntityUserAction *) nil_chk(act)) getJson];
    if (obj != nil) {
      (void) [array putWithId:obj];
    }
  }
  
#line 71
  NSString *miwen = [NSString stringWithString:[ComFqLibPlatformDES3Utils encryptModeWithByteArray:[((NSString *) nil_chk([array description])) getBytes] withByteArray:ComFqLibToolsConstants_get_KEY_STRING_()]];
  [ComFqLibFileHelper saveFileWithNSString:miwen withNSString:[((ComFqHalcyonExtendFilesystemFileSystem *) nil_chk([ComFqHalcyonExtendFilesystemFileSystem getInstance])) getUserActionPath] withBoolean:NO];
}


#line 76
- (void)addViewPatientActionWithNSString:(NSString *)patientName {
  
#line 77
  if (patientName == nil || [@"" isEqual:patientName]) {
    return;
  }
  int count = [((JavaUtilArrayList *) nil_chk(mActions_)) size];
  BOOL isNotExist = YES;
  for (int i = 0; i < count && isNotExist; i++) {
    ComFqHalcyonEntityUserAction *userAction = [mActions_ getWithInt:i];
    if ([((ComFqHalcyonEntityUserAction *) nil_chk(userAction)) getAction] != ComFqHalcyonEntityUserAction_ACTION_VIEW_PATIENT) {
      continue;
    }
    else {
      
#line 87
      if ([((NSString *) nil_chk(patientName)) isEqual:[userAction getDes]]) {
        isNotExist = NO;
        return;
      }
    }
  }
  if (isNotExist) {
    ComFqHalcyonEntityUserAction *action = [[ComFqHalcyonEntityUserAction alloc] initWithLong:[JavaLangSystem currentTimeMillis] withInt:ComFqHalcyonEntityUserAction_ACTION_VIEW_PATIENT withNSString:patientName];
    [self addActionWithComFqHalcyonEntityUserAction:action];
  }
}


#line 102
- (JavaUtilArrayList *)getCloseViewActions {
  
#line 106
  IOSObjectArray *actionKinds = [IOSObjectArray arrayWithObjects:(id[]){ [[JavaUtilArrayList alloc] init], [[JavaUtilArrayList alloc] init], [[JavaUtilArrayList alloc] init], [[JavaUtilArrayList alloc] init], [[JavaUtilArrayList alloc] init], [[JavaUtilArrayList alloc] init], [[JavaUtilArrayList alloc] init] } count:7 type:[IOSClass classWithClass:[JavaUtilArrayList class]]];
  JavaUtilArrayList *closeViewActions = [[JavaUtilArrayList alloc] init];
  if (mActions_ != nil) {
    int count = [mActions_ size];
    for (int i = 0; i < count; i++) {
      ComFqHalcyonEntityUserAction *userAction = [mActions_ getWithInt:i];
      int actionType = [((ComFqHalcyonEntityUserAction *) nil_chk(userAction)) getAction];
      if (actionType < (int) [actionKinds count]) {
        [((JavaUtilArrayList *) IOSObjectArray_Get(actionKinds, actionType)) addWithId:userAction];
      }
    }
    for (int i = 0; i < (int) [actionKinds count]; i++) {
      
#line 119
      [JavaUtilCollections shuffleWithJavaUtilList:IOSObjectArray_Get(actionKinds, i)];
    }
    
#line 122
    if ([((JavaUtilArrayList *) IOSObjectArray_Get(actionKinds, ComFqHalcyonEntityUserAction_ACTION_VIEW_PATIENT)) size] > 3) {
      [closeViewActions addWithId:(ComFqHalcyonEntityUserAction *) check_class_cast([((JavaUtilArrayList *) IOSObjectArray_Get(actionKinds, ComFqHalcyonEntityUserAction_ACTION_VIEW_PATIENT)) getWithInt:0], [ComFqHalcyonEntityUserAction class])];
    }
    else {
      
#line 127
      [closeViewActions addAllWithJavaUtilCollection:IOSObjectArray_Get(actionKinds, ComFqHalcyonEntityUserAction_ACTION_VIEW_PATIENT)];
    }
    
#line 130
    if ([((JavaUtilArrayList *) IOSObjectArray_Get(actionKinds, ComFqHalcyonEntityUserAction_ACTION_ADD_REMARK)) size] > 2) {
      [closeViewActions addWithId:(ComFqHalcyonEntityUserAction *) check_class_cast([((JavaUtilArrayList *) IOSObjectArray_Get(actionKinds, ComFqHalcyonEntityUserAction_ACTION_ADD_REMARK)) getWithInt:0], [ComFqHalcyonEntityUserAction class])];
    }
    else {
      [closeViewActions addAllWithJavaUtilCollection:IOSObjectArray_Get(actionKinds, ComFqHalcyonEntityUserAction_ACTION_ADD_REMARK)];
    }
    
#line 137
    if ([((JavaUtilArrayList *) IOSObjectArray_Get(actionKinds, ComFqHalcyonEntityUserAction_ACTION_ADD_DEOCTOR)) size] > 2) {
      [closeViewActions addWithId:(ComFqHalcyonEntityUserAction *) check_class_cast([((JavaUtilArrayList *) IOSObjectArray_Get(actionKinds, ComFqHalcyonEntityUserAction_ACTION_ADD_DEOCTOR)) getWithInt:0], [ComFqHalcyonEntityUserAction class])];
    }
    else {
      [closeViewActions addAllWithJavaUtilCollection:IOSObjectArray_Get(actionKinds, ComFqHalcyonEntityUserAction_ACTION_ADD_DEOCTOR)];
    }
    
#line 145
    if ([((JavaUtilArrayList *) IOSObjectArray_Get(actionKinds, ComFqHalcyonEntityUserAction_ACTION_ADD_PATIENT)) size] > 2) {
      [closeViewActions addWithId:(ComFqHalcyonEntityUserAction *) check_class_cast([((JavaUtilArrayList *) IOSObjectArray_Get(actionKinds, ComFqHalcyonEntityUserAction_ACTION_ADD_PATIENT)) getWithInt:0], [ComFqHalcyonEntityUserAction class])];
    }
    else {
      [closeViewActions addAllWithJavaUtilCollection:IOSObjectArray_Get(actionKinds, ComFqHalcyonEntityUserAction_ACTION_ADD_PATIENT)];
    }
  }
  [JavaUtilCollections shuffleWithJavaUtilList:closeViewActions];
  
#line 154
  int upCount = [((JavaUtilArrayList *) IOSObjectArray_Get(actionKinds, ComFqHalcyonEntityUserAction_ACTION_UP_RECORD)) size];
  ComFqHalcyonEntityUserAction *upCountAction = [[ComFqHalcyonEntityUserAction alloc] initWithLong:[JavaLangSystem currentTimeMillis] withInt:ComFqHalcyonEntityUserAction_ACTION_UP_RECORD withNSString:[NSString stringWithFormat:@"%d\u4efd", upCount]];
  [closeViewActions addWithInt:0 withId:upCountAction];
  return closeViewActions;
}


#line 160
- (JavaUtilArrayList *)getActions {
  
#line 161
  return mActions_;
}

- (void)copyAllFieldsTo:(ComFqLibUserActionManger *)other {
  [super copyAllFieldsTo:other];
  other->mActions_ = mActions_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "init", "UserActionManger", NULL, 0x2, NULL },
    { "getInstance", NULL, "Lcom.fq.lib.UserActionManger;", 0x9, NULL },
    { "addActionWithComFqHalcyonEntityUserAction:", "addAction", "V", 0x1, NULL },
    { "addViewPatientActionWithNSString:", "addViewPatientAction", "V", 0x1, NULL },
    { "getCloseViewActions", NULL, "Ljava.util.ArrayList;", 0x1, NULL },
    { "getActions", NULL, "Ljava.util.ArrayList;", 0x1, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "mInstance_", NULL, 0xa, "Lcom.fq.lib.UserActionManger;", &ComFqLibUserActionManger_mInstance_,  },
    { "mActions_", NULL, 0x2, "Ljava.util.ArrayList;", NULL,  },
  };
  static J2ObjcClassInfo _ComFqLibUserActionManger = { "UserActionManger", "com.fq.lib", NULL, 0x1, 6, methods, 2, fields, 0, NULL};
  return &_ComFqLibUserActionManger;
}

@end
